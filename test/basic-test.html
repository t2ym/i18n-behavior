<!--
@license https://github.com/t2ym/i18n-behavior/blob/master/LICENSE.md
Copyright (c) 2016, Tetsuya Mori <t2y3141592@gmail.com>. All rights reserved.
-->
<html lang="en" preferred>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../i18n-behavior.html">
    <link rel="import" href="simple-text-element.html">
    <link rel="import" href="commented-simple-text-element.html">
    <link rel="import" href="plural-gender-element.html">
  </head>
  <body>

    <test-fixture id="simple-text-element-default">
      <template>
        <simple-text-element></simple-text-element>
      </template>
    </test-fixture>

    <test-fixture id="commented-simple-text-element-default">
      <template>
        <commented-simple-text-element></commented-simple-text-element>
      </template>
    </test-fixture>

    <test-fixture id="simple-text-element">
      <template is="dom-template" id="bound-simple-text-element">
        <simple-text-element 
          lang="{{lang}}"
          observe-html-lang="{{observeHtmlLang}}">
        </simple-text-element>
      </template>
    </test-fixture>

    <test-fixture id="commented-simple-text-element">
      <template is="dom-template" id="bound-commented-simple-text-element">
        <commented-simple-text-element 
          lang="{{lang}}"
          observe-html-lang="{{observeHtmlLang}}">
        </commented-simple-text-element>
      </template>
    </test-fixture>

    <test-fixture id="plural-gender-element">
      <template is="dom-template">
        <plural-gender-element
          lang="{{lang}}"
          observe-html-lang="{{observeHtmlLang}}"
          sender="{{sender}}"
          recipients="{{recipients}}">
        </plural-gender-element>
      </template>
    </test-fixture>

<!--
    <test-fixture id="static">
      <template>
        <i18n-format lang="en">
          <span>Parameter {1} and {2} are rendered.</span>
          <b>A</b>
          <i>B</i>
        </i18n-format>
      </template>
    </test-fixture>

    <test-fixture id="non-default-attributes">
      <template>
        <i18n-format lang="fr" param-attribute="parameter" param-format="%n%">
          <span>Parameter %1% and %2% are rendered.</span>
          <b>A</b>
          <i>B</i>
        </i18n-format>
      </template>
    </test-fixture>

    <test-fixture id="bound">
      <template is="dom-template" id="bound-template">
        <i18n-format lang="{{lang}}">
          <span>{{text.0}}</span>
          <b>{{text.1}}</b>
          <i>{{text.2}}</i>
        </i18n-format>
      </template>
    </test-fixture>

    <test-fixture id="compound-static">
      <template>
        <i18n-format lang="en">
          <json-data>{
            "0": "You ({3}) gave no gifts.",
            "1": {
              "male": "You ({3}) gave him ({4}) {5}.",
              "female": "You ({3}) gave her ({4}) {5}.",
              "other": "You ({3}) gave them ({4}) {5}."
            },
            "one": {
              "male": "You ({3}) gave him ({4}) and one other person {5}.",
              "female": "You ({3}) gave her ({4}) and one other person {5}.",
              "other": "You ({3}) gave them ({4}) and one other person {5}."
            },
            "other": "You ({3}) gave them ({4}) and {1} other people gifts."
          }</json-data>
          <i18n-number lang="en" offset="1">2</i18n-number>
          <span>female</span>
          <span>Joe</span>
          <span>Alice</span>
          <span>a gift</span>
        </i18n-format>
      </template>
    </test-fixture>

    <test-fixture id="bound-and-wrapped">
      <template is="dom-template" id="bound-and-wrapped-template">
        <bound-i18n-format 
          lang="{{lang}}"
          text="{{text}}"
          param-format="{{paramFormat}}"
          compound-text="{{compoundText}}"
          recipients="{{recipients}}"
          sender="{{sender}}"></bound-i18n-format>
      </template>
    </test-fixture>
-->
    <script>
suite('I18nBehavior', function () {

/*
  suite('default values', function () {
    var el;

    setup(function () {
      el = fixture('default');
    });

    test('default lang property', function () {
      assert.equal(el.lang, 'en', 'default lang is en');
    });

    test('DEFAULT_LANG property', function () {
      assert.equal(el.DEFAULT_LANG, 'en', 'DEFAULT_LANG is en');
    });

    test('default paramAttribute property', function () {
      assert.equal(el.paramAttribute, 'param', 'default paramAttribute is param');
    });

    test('default paramFormat property', function () {
      assert.equal(el.paramFormat, '{n}', 'default paramFormat is {n}');
    });

    test('default observeParams property', function () {
      assert.isBoolean(el.observeParams, 'observeParams is a Boolean');
      assert.equal(el.observeParams, true, 'default observeParams is true');
    });

    test('default textContent is empty', function () {
      assert.equal(Polymer.dom(el.root).textContent, '', 'textContent is empty');
    });

  });
*/

  if (!Number.isNaN) {
    // polyfill Number.isNaN for IE11
    Number.isNaN = function (value) {
      return typeof value === 'number' && isNaN(value);
    };
  }
  var lang0 = '';
  var lang1 = 'en';
  var lang2 = 'fr';
  var lang3 = 'ja';
  var text_simple = {
    'model': {},
    'text': ' outermost text at the beginning ',
    'h1_3': 'outermost header 1',
    'text_4': ' outermost text in the middle ',
    'span_5': 'simple text without id',
    'span_6': 'simple text without id 2',
    'label-1': 'simple text with id',
    'label-2': 'simple text with id 2',
    'div_9:span': 'simple text within div',
    'div_9:span_1': 'simple text within div 2',
    'div_9:div_2:div': 'great grandchild text within div',
    'div_10:text': ' simple text as the first element in div ',
    'div_10:span_1': 'simple text within div',
    'div_10:text_2': ' simple text in the middle of div ',
    'div_10:span_3': 'simple text within div 2',
    'div_10:div_4:div': 'great grandchild text within div',
    'div_10:text_5': ' simple text at the last element in div ',
    'toplevel-div:span': 'simple text within div',
    'toplevel-div:span_1': 'simple text within div 2',
    'third-level-div': 'great grandchild text within div',
    'second-level-div:div_1': 'great grandchild text within div without id',
    'div_12:ul:li': 'line item without id 1',
    'div_12:ul:li_1': 'line item without id 2',
    'div_12:ul:li_2': 'line item without id 3',
    'line-items:li': 'line item with id 1',
    'line-items:li_1': 'line item with id 2',
    'line-items:li_2': 'line item with id 3',
    'p_13': [
      'A paragraph with {1} is converted to {2}.',
      'parameters',
      '<i18n-format>'
    ],
    'paragraph': [
      'A paragraph with {1} is converted to {2}.',
      'id',
      '<i18n-format>'
    ],
    'text_15': ' outermost text at the end '
  };
  var localDOM_simple = [
    { select: 'div:not([id])', 'previousTextSibling.data': ' outermost text at the beginning ' },
    { select: 'h1', textContent: 'outermost header 1' },
    { select: 'h1', 'nextTextSibling.data': ' outermost text in the middle ' },
    { select: 'span:not([id])', textContent: [ 'simple text without id', 'simple text without id 2' ] },
    { select: 'span[id="label-1"]', textContent: 'simple text with id' },
    { select: 'span[id="label-2"]', textContent: 'simple text with id 2' },
    { select: 'span[id="label-2"] + div span:not([id])', textContent:  [ 'simple text within div', 'simple text within div 2' ] },
    { select: 'span[id="label-2"] + div div:not([id]) div:not([id])', textContent: [ 'great grandchild text within div' ] },
    { select: 'span[id="label-2"] + div + div', 'childNodes.0.data': ' simple text as the first element in div ' },
    { select: 'span[id="label-2"] + div + div span:not([id])', textContent:  [ 'simple text within div', 'simple text within div 2' ] },
    { select: 'span[id="label-2"] + div + div span:not([id])', 'nextTextSibling.data': ' simple text in the middle of div ' },
    { select: 'span[id="label-2"] + div + div div:not([id]) div:not([id])', textContent: 'great grandchild text within div' },
    { select: 'span[id="label-2"] + div + div div:not([id])', 'nextTextSibling.data': ' simple text at the last element in div ' },
    { select: '[id="toplevel-div"] span:not([id])', textContent: [ 'simple text within div', 'simple text within div 2' ] },
    { select: '[id="third-level-div"]', textContent: 'great grandchild text within div' },
    { select: '[id="second-level-div"] div:not([id])', textContent: 'great grandchild text within div without id' },
    { select: 'div ul:not([id]) li:not([id])', textContent: [ 'line item without id 1', 'line item without id 2', 'line item without id 3' ] },
    { select: '[id="line-items"] li:not([id])', textContent: [ 'line item with id 1', 'line item with id 2', 'line item with id 3' ] },
    { select: 'p:not([id]) i18n-format', 
      'PolymerDom.children.0.textContent': 'A paragraph with {1} is converted to {2}.' },
    { select: 'p:not([id]) i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'parameters',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: 'p:not([id]) i18n-format',
      'PolymerDom.children.2.tagName': 'CODE',
      'PolymerDom.children.2.textContent': '<i18n-format>',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.0.textContent': 'A paragraph with {1} is converted to {2}.' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.1.tagName': 'B',
      'PolymerDom.children.1.textContent': 'id',
      'PolymerDom.children.1.attributes.param.value': '1' },
    { select: '[id="paragraph"] i18n-format',
      'PolymerDom.children.2.tagName': 'CODE',
      'PolymerDom.children.2.textContent': '<i18n-format>',
      'PolymerDom.children.2.attributes.param.value': '2' },
    { select: '[id="paragraph"]', 'nextTextSibling.data': ' outermost text at the end ' }
  ];
  var sender1 = {
    'name': 'Joe',
    'gender': 'male'
  };
  var recipients1 = [
    { 'name': 'Alice', 'gender': 'female' },
    { 'name': 'Bob', 'gender': 'male' },
    { 'name': 'Yoda', 'gender': 'other' }
  ];
  var text_plural_gender = {
    'model': {},
    'compound-format-text': [
      {
        '0': 'You ({3}) gave no gifts.',
        '1': {
          'male': 'You ({3}) gave him ({4}) {5}.',
          'female': 'You ({3}) gave her ({4}) {5}.',
          'other': 'You ({3}) gave them ({4}) {5}.'
        },
        'one': {
          'male': 'You ({3}) gave him ({4}) and one other person {5}.',
          'female': 'You ({3}) gave her ({4}) and one other person {5}.',
          'other': 'You ({3}) gave them ({4}) and one other person {5}.'
        },
        'other': 'You ({3}) gave them ({4}) and {1} other people gifts.'
      },
      '{{recipients.length - 1}}',
      '{{recipients.0.gender}}',
      '{{sender.name}}',
      '{{recipients.0.name}}',
      'a gift'
    ]
  };
  var localDOM_plural_gender_1 = [
    { select: '#compound-format-text', 'root.PolymerDom.textContent': 'You () gave them () and  other people gifts.' },
    { select: '#compound-format-text', 'PolymerDom.children.1.PolymerDom.childNodes.0.data.raw': '3' },
    { select: '#compound-format-text', 'PolymerDom.children.2.PolymerDom.childNodes.0.data.raw': 'female' },
    { select: '#compound-format-text', 'PolymerDom.children.3.PolymerDom.childNodes.0.data.raw': 'Joe' },
    { select: '#compound-format-text', 'PolymerDom.children.4.PolymerDom.childNodes.0.data.raw': 'Alice' },
    { select: '#compound-format-text', 'PolymerDom.children.5.PolymerDom.childNodes.0.data': 'a gift' }
  ];

  var suites = [
    { 
      suite: 'simple text default', 
      fixture: 'simple-text-element-default', 
      fixtureModel: undefined, 
      assign: undefined,
      lang: lang1,
      effectiveLang: lang1,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'commented simple text default', 
      fixture: 'commented-simple-text-element-default', 
      fixtureModel: undefined, 
      assign: undefined,
      lang: lang1,
      effectiveLang: lang1,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'simple text default null lang', 
      fixture: 'simple-text-element-default', 
      fixtureModel: undefined, 
      assign: { lang: lang0 },
      lang: lang0,
      effectiveLang: lang0,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'commented simple text default null lang', 
      fixture: 'commented-simple-text-element-default', 
      fixtureModel: undefined, 
      assign: { lang: lang0 },
      lang: lang0,
      effectiveLang: lang0,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'fr simple text default', 
      fixture: 'simple-text-element-default', 
      fixtureModel: undefined, 
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'fr commented simple text default',
      fixture: 'commented-simple-text-element-default', 
      fixtureModel: undefined, 
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'simple text', 
      fixture: 'simple-text-element', 
      fixtureModel: { observeHtmlLang: false, lang: lang0 }, 
      assign: undefined,
      lang: lang0,
      effectiveLang: lang0,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'simple text', 
      fixture: 'simple-text-element', 
      fixtureModel: { observeHtmlLang: false, lang: lang0 }, 
      assign: { lang: lang1 },
      lang: lang1,
      effectiveLang: lang1,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: lang2 + ' simple text', 
      fixture: 'simple-text-element', 
      fixtureModel: { observeHtmlLang: false, lang: lang0 }, 
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'commented simple text', 
      fixture: 'commented-simple-text-element', 
      fixtureModel: { observeHtmlLang: false, lang: lang2 }, 
      assign: undefined,
      lang: lang2,
      effectiveLang: lang2,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'commented simple text', 
      fixture: 'commented-simple-text-element', 
      fixtureModel: { observeHtmlLang: false, lang: lang0 }, 
      assign: undefined,
      lang: lang0,
      effectiveLang: lang0,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: 'commented simple text', 
      fixture: 'commented-simple-text-element', 
      fixtureModel: { observeHtmlLang: false, lang: lang0 }, 
      assign: { lang: lang1 },
      lang: lang1,
      effectiveLang: lang1,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: lang2 + ' commented simple text', 
      fixture: 'commented-simple-text-element', 
      fixtureModel: { observeHtmlLang: false, lang: lang0 }, 
      assign: { lang: lang2 },
      lang: lang2,
      effectiveLang: lang2,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    { 
      suite: lang2 + ' commented simple text', 
      fixture: 'commented-simple-text-element', 
      fixtureModel: { observeHtmlLang: false, lang: lang2 }, 
      assign: undefined,
      lang: lang2,
      effectiveLang: lang2,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      text: text_simple,
      model: {},
      localDOM: localDOM_simple,
      lightDOM: undefined
    },
    {
      suite: 'plural gender', 
      fixture: 'plural-gender-element', 
      fixtureModel: {
        observeHtmlLang: false,
        lang: lang0
      }, 
      assign: {
        lang: lang1,
        sender: sender1,
        recipients: recipients1
      },
      lang: lang1,
      effectiveLang: lang1,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      event: 'local-dom-ready',
      text: text_plural_gender,
      model: {},
      localDOM: localDOM_plural_gender_1,
      lightDOM: undefined
    },
    {
      suite: lang2 + ' plural gender', 
      fixture: 'plural-gender-element', 
      fixtureModel: {
        observeHtmlLang: false,
        lang: lang0
      }, 
      assign: {
        lang: lang2,
        sender: sender1,
        recipients: recipients1
      },
      lang: lang2,
      effectiveLang: lang2,
      templateDefaultLang: lang1,
      observeHtmlLang: false,
      event: 'local-dom-ready',
      text: text_plural_gender,
      model: {},
      localDOM: localDOM_plural_gender_1,
      lightDOM: undefined
    },
/*
    { 
      suite: 'simple text', 
      fixture: 'simple-text-element', 
      fixtureModel: { observeHtmlLang: true, lang: lang0 }, 
      assign: {}, //{ lang: lang1 },
      lang: lang0,
      effectiveLang: lang0,
      templateDefaultLang: lang1,
      observeHtmlLang: true,
      childNodes: [
        { nodeName: '#text', data: 'Parameter ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[param=\'2\']' },
        { nodeName: '#text', data: ' are rendered.' }
      ],
      parameters: [
        { select: 'b[param=\'1\']', textContent: 'A' },
        { select: 'i[param=\'2\']', textContent: 'B' }
      ]
    }
    { 
      suite: 'non-default static parameters', 
      fixture: 'non-default-attributes', 
      fixtureModel: undefined, 
      lang: lang2,
      paramAttribute: paramAttribute2,
      paramFormat: paramFormat2,
      childNodes: [
        { nodeName: '#text', data: 'Parameter ' },
        { nodeName: 'CONTENT', select: '[parameter=\'1\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[parameter=\'2\']' },
        { nodeName: '#text', data: ' are rendered.' }
      ],
      parameters: [
        { select: 'b[parameter=\'1\']', textContent: 'A' },
        { select: 'i[parameter=\'2\']', textContent: 'B' }
      ]
    },
    { 
      suite: 'static bound values', 
      fixture: 'bound', 
      fixtureModel: {
        lang: 'en',
        text: [
          'Parameter {1} and {2} are rendered.',
          'A',
          'B'
        ]
      }, 
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'Parameter ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[param=\'2\']' },
        { nodeName: '#text', data: ' are rendered.' }
      ],
      parameters: [
        { select: 'b[param=\'1\']', textContent: 'A' },
        { select: 'i[param=\'2\']', textContent: 'B' }
      ]
    },
    { 
      suite: 'static compound template', 
      fixture: 'compound-static', 
      fixtureModel: undefined,
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and one other person ' },
        { nodeName: 'CONTENT', select: '[param=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    }
    { 
      suite: 'change text values', 
      fixture: 'bound', 
      fixtureModel: {
        lang: 'en',
        text: [
          'Parameter {1} and {2} are rendered.',
          'A',
          'B'
        ]
      }, 
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      assign: { 
        text: [
          'Param {2} and {1} are rendered.',
          'AAA',
          'BBB'
        ]
      },
      childNodes: [
        { nodeName: '#text', data: 'Param ' },
        { nodeName: 'CONTENT', select: '[param=\'2\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' are rendered.' }
      ],
      parameters: [
        { select: 'b[param=\'1\']', textContent: 'AAA' },
        { select: 'i[param=\'2\']', textContent: 'BBB' }
      ]
    },
    { 
      suite: 'change raw value', 
      fixture: 'bound', 
      fixtureModel: { number: '987654.321' }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: {},
      assign: { raw: rawValue1 },
      formatted: formatted1_en
    },
    { 
      suite: 'change lang value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: {},
      assign: { lang: 'fr' },
      formatted: formatted1_fr
    },
    { 
      suite: 'change options object value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'USD' },
      assign: { options: { 'style': 'currency', 'currency': 'USD' } },
      formatted: formatted1_USD
    },
    { 
      suite: 'change options property values', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'USD' },
      assign: { 'options': {}, 'options.style': 'currency', 'options.currency': 'USD' },
      formatted: formatted1_USD
    },
    { 
      suite: 'change currency options object value', 
      fixture: 'bound-currency-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'JPY' },
      assign: { options: { 'style': 'currency', 'currency': 'JPY' } },
      formatted: formatted1_JPY
    },
    { 
      suite: 'change currency options property values', 
      fixture: 'bound-currency-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'JPY' },
      assign: { 'options.currency': 'JPY' },
      formatted: formatted1_JPY
    },
    { 
      suite: 'default options object value', 
      fixture: 'bound-default-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: undefined,
      formatted: formatted1_en
    },
    { 
      suite: 'change options object value from default options', 
      fixture: 'bound-default-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'USD' },
      assign: { options: { 'style': 'currency', 'currency': 'USD' } },
      formatted: formatted1_USD
    },
    { 
      suite: 'change options property values from default options', 
      fixture: 'bound-default-options', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset1,
      rawNumber: rawNumber1,
      number: number1,
      options: { 'style': 'currency', 'currency': 'USD' },
      assign: { 'options': {}, 'options.style': 'currency', 'options.currency': 'USD' },
      formatted: formatted1_USD
    },
    { 
      suite: 'change offset value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offset2,
      rawNumber: rawNumber1,
      number: number2,
      options: {},
      assign: { offset: offset2 },
      formatted: formatted1_offset
    },
    { 
      suite: 'invalid value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValueInvalid }, 
      rawValue: rawValueInvalid,
      offset: offset1,
      rawNumber: NaN,
      number: NaN,
      options: {},
      formatted: 'NaN'
    },
    { 
      suite: 'invalid offset value', 
      fixture: 'bound', 
      fixtureModel: { number: rawValue1 }, 
      rawValue: rawValue1,
      offset: offsetInvalid,
      rawNumber: rawValue1,
      number: NaN,
      options: {},
      assign: { offset: offsetInvalid },
      formatted: 'NaN'
    }
*/
  ];

  var updateProperty = function (element, properties) {
    for (var name in properties) {
      var path = name.split(/[.]/);
      if (path.length === 1) {
        element[name] = properties[name];
      }
      else {
        var cursor = element;
        var p = path.shift();
        while (p) {
          if (path.length < 1) {
            cursor[p] = properties[name];
            element.notifyPath(name, properties[name], true);
            break;
          }
          else if (p === 'PolymerDom') {
            cursor = Polymer.dom(cursor);
          }
          else {
            cursor = cursor[p];
          }
          p = path.shift();
        }
      }
    }
  };

  var updateModel = function (element, model) {
    for (var name in model) {
      var path = name.split(/[.]/);
      if (path.length === 1) {
        element[name] = model[name];
        //console.log('updateModel: notifyPath: name = ' + name);
        //element.notifyPath(name, model[name], true);
      }
      else {
        var cursor = element;
        var p = path.shift();
        while (p) {
          if (path.length < 1) {
            cursor[p] = model[name];
            element.notifyPath(name, model[name], true);
            break;
          }
          else if (p === 'PolymerDom') {
            cursor = Polymer.dom(cursor);
          }
          else {
            cursor = cursor[p];
          }
          p = path.shift();
        }
      }
    }
  };

  var getProperty = function (target, name) {
    var path = name.split(/[.]/);
    if (path.length === 1) {
      return target[name];
    }
    else {
      var cursor = target;
      var p = path.shift();
      while (p) {
        //console.log(p, cursor);
        if (path.length < 1) {
          if (p === 'raw') {
            return cursor;
          }
          else {
            return cursor[p];
          }
        }
        else if (p === 'PolymerDom') {
          cursor = Polymer.dom(cursor);
        }
        else if (p === 'previousTextSibling') {
          do {
            cursor = cursor.previousSibling;
          } while (cursor.nodeType === cursor.COMMENT_NODE ||
                   (cursor.nodeType === cursor.TEXT_NODE && cursor.data.match(/^[\s]*$/)));
        }
        else if (p === 'nextTextSibling') {
          do {
            cursor = cursor.nextSibling;
          } while (cursor.nodeType === cursor.COMMENT_NODE ||
                   (cursor.nodeType === cursor.TEXT_NODE && cursor.data.match(/^[\s]*$/)));
        }
        else {
          cursor = cursor[p];
        }
        p = path.shift();
      }
    }
  };

  function deepMap (target, source, map) {
    var value;
    for (var prop in source) {
      value = source[prop];
      switch (typeof value) {
      case 'string':
      case 'number':
      case 'boolean':
        if (typeof target === 'object') {
          target[prop] = map(value, prop);
        }
        break;
      case 'object':
        if (typeof target === 'object') {
          if (Array.isArray(value)) {
            target[prop] = target[prop] || [];
            deepMap(target[prop], value, map);
          }
          else {
            target[prop] = target[prop] || {};
            deepMap(target[prop], value, map);
          }
        }
        break;
      case 'function':
      case 'symbol':
      case 'undefined':
        if (typeof target === 'object') {
          target[prop] = value;
        }
        break;
      default:
        if (typeof target === 'object') {
          target[prop] = value;
        }
        break;
      }
    }
  }

  var translate = function (lang, path, text) {
    var result;
    switch (lang) {
    case '':
    case 'en':
    case null:
    case undefined:
      result = text;
      break;
    default:
      if (!path || path.match(/(textContent|[.]data)$/)) {
        result = {};
        deepMap(result, { text: text }, function (value, prop) {
          if (typeof value === 'string' &&
              !value.match(/^({{[^{}]*}}|\[\[[^\[\]]*\]\])$/)) {
            return lang + ' ' + value;
          }
          return value;
        });
        result = result.text;
      }
      else {
        result = text;
      }
    }
    console.log('translate (' + lang + ', ' + path + ', ' + JSON.stringify(text, null, 2) + ') = ' + JSON.stringify(result, null, 2));
    return result;
  };

  suites.forEach(function (params) {

    suite(params.suite, function () {
      var el;
      var p;
      var n;
      var i, j;
      var results;
      var node;
      var rawValue = params.rawValue;
      var fixtureElement;
      var noProperties;
      var lang = params.assign && params.assign.lang ? params.assign.lang : 'en';
      var event = params.event ? params.event : 'lang-updated';

      suite(params.suite + ' lang property', function () {
        setup(function () {
          el = fixture(params.fixture, params.fixtureModel);
        });

        test('lang property is set as ' + params.lang, function () {
          updateProperty(el, params.assign);
          assert.isString(el.lang, 'lang property is a string');
          assert.equal(el.lang, params.lang, 'lang is set');
        });
      });


      if (params && params.assign && params.assign.lang) {
        suite(params.suite + ' lang-updated event', function () {
          setup(function () {
            el = fixture(params.fixture, params.fixtureModel);
          });

          test('lang-updated event is fired', function (done) {
            el.addEventListener('lang-updated', function langUpdatedFired (e) {
              assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
              el.removeEventListener('lang-updated', langUpdatedFired);
              done();
            });
            updateProperty(el, params.assign);
          });
        });
      }

      suite(params.suite + ' effectiveLang property', function () {
        setup(function () {
          el = fixture(params.fixture, params.fixtureModel);
        });

        test('effectiveLang property is set as ' + params.effectiveLang, function (done) {
          if (params && params.assign && params.assign.lang) {
            el.addEventListener('lang-updated', function effectiveLangIsSet (e) {
              assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
              assert.isString(el.effectiveLang, 'effectiveLang property is a string');
              assert.equal(el.effectiveLang, params.effectiveLang, 'effectiveLang property is set');
              el.removeEventListener('lang-updated', effectiveLangIsSet);
              done();
            });
            updateProperty(el, params.assign);
          }
          else {
            updateProperty(el, params.assign);
            assert.isString(el.effectiveLang, 'effectiveLang property is a string');
            assert.equal(el.effectiveLang, params.effectiveLang, 'effectiveLang property is set');
            done();
          }
        });
      });

      suite(params.suite + ' templateDefaultLang property', function () {
        setup(function () {
          el = fixture(params.fixture, params.fixtureModel);
        });

        test('templateDefaultLang property is set as ' + params.templateDefaultLang, function () {
          updateProperty(el, params.assign);
          assert.isString(el.templateDefaultLang, 'templateDefaultLang property is a string');
          assert.equal(el.templateDefaultLang, params.templateDefaultLang, 'templateDefaultLang property is set');
        });
      });

      suite(params.suite + ' observeHtmlLang property', function () {
        setup(function () {
          el = fixture(params.fixture, params.fixtureModel);
        });

        test('observeHtmlLang property is set as ' + params.observeHtmlLang, function () {
          updateProperty(el, params.assign);
          assert.isBoolean(el.observeHtmlLang, 'observeHtmlLang property is a Boolean');
          assert.equal(el.observeHtmlLang, params.observeHtmlLang, 'observeHtmlLang property is set');
        });
      });

      if (params.text) {
        suite(params.suite + ' text property', function () {
          setup(function () {
            el = fixture(params.fixture, params.fixtureModel);
          });

          test('text' + ' property is set as ' + JSON.stringify(params.text,null,2) + (params.assign && params.assign.lang ? ' for ' + params.assign.lang : ''), function (done) {
            noProperties = true;
            if (params && params.assign && params.assign.lang) {
              el.addEventListener('lang-updated', function textIsSet (e) {
                assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                assert.isObject(el.text, 'text property is an object');
                for (p in params.text) {
                  noProperties = false;
                  assert.deepEqual(el.text[p], translate(el.effectiveLang, null, params.text[p]), 'text.' + p + ' property is set for ' + el.effectiveLang);
                }
                el.removeEventListener('lang-updated', textIsSet);
                done();
              });
              updateProperty(el, params.assign);
            }
            else {
              updateProperty(el, params.assign);
              assert.isObject(el.text, 'text property is an object');
              assert.deepEqual(el.text[p], translate(el.effectiveLang, null, params.text[p]), 'text.' + p + ' property is set for ' + el.effectiveLang);
              done();
            }
            if (noProperties) {
              test('text property is set as ' + JSON.stringify(params.text), function () {
                updateProperty(el, params.assign);
                assert.isObject(el.text, 'text property is an object');
                assert.deepEqual(el.text, params.text, 'text property is set');
              });
            }
          });
        });
      }

      if (params.model) {
        suite(params.suite + ' model property', function () {
          setup(function () {
            el = fixture(params.fixture, params.fixtureModel);
          });

          test('model' + ' property is set as ' + JSON.stringify(params.model,null,2) + (params.assign && params.assign.lang ? ' for ' + params.assign.lang : ''), function (done) {
            noProperties = true;
            if (params && params.assign && params.assign.lang) {
              el.addEventListener('lang-updated', function modelIsSet (e) {
                assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                assert.isObject(el.model, 'model property is an object');
                for (p in params.model) {
                  noProperties = false;
                  assert.deepEqual(el.model[p], translate(el.effectiveLang, null, params.model[p]), 'model.' + p + ' property is set for ' + el.effectiveLang);
                }
                el.removeEventListener('lang-updated', modelIsSet);
                done();
              });
              updateProperty(el, params.assign);
            }
            else {
              updateProperty(el, params.assign);
              assert.isObject(el.model, 'model property is an object');
              assert.deepEqual(el.model[p], translate(el.effectiveLang, null, params.model[p]), 'model.' + p + ' property is set for ' + el.effectiveLang);
              done();
            }
            if (noProperties) {
              test('model property is set as ' + JSON.stringify(params.model), function () {
                updateProperty(el, params.assign);
                assert.isObject(el.model, 'model property is an object');
                assert.deepEqual(el.model, params.model, 'model property is set');
              });
            }
          });
        });
      }

      if (params.localDOM) {
        suite(params.suite + ' local DOM', function () {
          setup(function () {
            el = fixture(params.fixture, params.fixtureModel);
          });

          test('local DOM ' + JSON.stringify(params.localDOM, null, 2) + ' is set' + 
                (params.assign && params.assign.lang ? ' for ' + params.assign.lang : ''), 
            function (done) {
              if (params && params.assign && params.assign.lang) {
                el.addEventListener(event, function localDomSet (e) {
                  assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                  params.localDOM.forEach(function (childPath) {
                    var completeStatus;
                    var nodes = Polymer.dom(el.root).querySelectorAll(childPath.select);
                    assert.ok(nodes.length > 0, childPath.select + ' is defined');
                    for (var p in childPath) {
                      if (p === 'select') {
                        continue;
                      }
                      //console.log(p + ' is set as ' + childPath[p]);
                      if (Array.isArray(childPath[p])) {
                        //console.log(nodes);
                        Array.prototype.forEach.call(childPath[p], function (path, i, a) {
                          assert.equal(getProperty(nodes[i], p), translate(el.effectiveLang, p, path), p + ' is set as ' + translate(el.effectiveLang, p, path));
                        });
                      }
                      else {
                        //console.log(nodes[0]);
                        assert.equal(getProperty(nodes[0], p), translate(el.effectiveLang, p, childPath[p]), p + ' is set as ' + translate(el.effectiveLang, p, childPath[p]));
                      }
                    }
                    //console.log(childPath);
                  });
                  el.removeEventListener(event, localDomSet);
                  done();
                });
                updateProperty(el, params.assign);
              }
              else {
                updateProperty(el, params.assign);
                params.localDOM.forEach(function (childPath) {
                  var nodes = Polymer.dom(el.root).querySelectorAll(childPath.select);
                  assert.ok(nodes.length > 0, childPath.select + ' is defined');
                  for (var p in childPath) {
                    if (p === 'select') {
                      continue;
                    }
                    //console.log(p + ' is set as ' + childPath[p]);
                    if (Array.isArray(childPath[p])) {
                      //console.log(nodes);
                      Array.prototype.forEach.call(childPath[p], function (path, i, a) {
                        assert.equal(getProperty(nodes[i], p), translate(el.lang, p, path), p + ' is set as ' + translate(el.lang, p, path));
                      });
                    }
                    else {
                      //console.log(nodes[0]);
                      assert.equal(getProperty(nodes[0], p), translate(el.lang, p, childPath[p]), p + ' is set as ' + translate(el.lang, p, childPath[p]));
                    }
                  }
                  //console.log(childPath);
                });
                done();
              }
            }
          );
        });
      }

      if (params.lightDOM) {
        suite(params.suite + ' light DOM', function () {
          setup(function () {
            el = fixture(params.fixture, params.fixtureModel);
          });

          test('light DOM ' + JSON.stringify(params.lightDOM, null, 2) + ' is set' + 
                (params.assign && params.assign.lang ? ' for ' + params.assign.lang : ''), 
            function (done) {
              if (params && params.assign && params.assign.lang) {
                el.addEventListener(event, function lightDomSet (e) {
                  assert.equal(el, Polymer.dom(e).rootTarget, 'event target is the element');
                  params.lightDOM.forEach(function (childPath) {
                    var completeStatus;
                    var nodes = Polymer.dom(el).querySelectorAll(childPath.select);
                    assert.ok(nodes.length > 0, childPath.select + ' is defined');
                    for (var p in childPath) {
                      if (p === 'select') {
                        continue;
                      }
                      //console.log(p + ' is set as ' + childPath[p]);
                      if (Array.isArray(childPath[p])) {
                        //console.log(nodes);
                        Array.prototype.forEach.call(childPath[p], function (path, i, a) {
                          assert.equal(getProperty(nodes[i], p), translate(el.effectiveLang, p, path), p + ' is set as ' + translate(el.effectiveLang, p, path));
                        });
                      }
                      else {
                        //console.log(nodes[0]);
                        assert.equal(getProperty(nodes[0], p), translate(el.effectiveLang, p, childPath[p]), p + ' is set as ' + translate(el.effectiveLang, p, childPath[p]));
                      }
                    }
                    //console.log(childPath);
                  });
                  el.removeEventListener(event, lightDomSet);
                  done();
                });
                updateProperty(el, params.assign);
              }
              else {
                updateProperty(el, params.assign);
                params.localDOM.forEach(function (childPath) {
                  var nodes = Polymer.dom(el).querySelectorAll(childPath.select);
                  assert.ok(nodes.length > 0, childPath.select + ' is defined');
                  for (var p in childPath) {
                    if (p === 'select') {
                      continue;
                    }
                    //console.log(p + ' is set as ' + childPath[p]);
                    if (Array.isArray(childPath[p])) {
                      //console.log(nodes);
                      Array.prototype.forEach.call(childPath[p], function (path, i, a) {
                        assert.equal(getProperty(nodes[i], p), translate(el.lang, p, path), p + ' is set as ' + translate(el.lang, p, path));
                      });
                    }
                    else {
                      //console.log(nodes[0]);
                      assert.equal(getProperty(nodes[0], p), translate(el.lang, p, childPath[p]), p + ' is set as ' + translate(el.lang, p, childPath[p]));
                    }
                  }
                  //console.log(childPath);
                });
                done();
              }
            }
          ); 
        });
      }

/*
      test('childNodes are set as ' + JSON.stringify(params.childNodes), function () {
        updateProperty(el, params.assign);
        var childNodes = Polymer.dom(el.root).childNodes;
        var i;
        for (i = 0; i < params.childNodes.length; i++) {
          for (var p in params.childNodes[i]) {
            assert.equal(childNodes[i][p] || childNodes[i].getAttribute(p), params.childNodes[i][p], p + ' is set as ' + params.childNodes[i][p]);
          }
        }
      });

      test('parameters are set as ' + JSON.stringify(params.parameters), function () {
        updateProperty(el, params.assign);
        var i;
        for (i = 0; i < params.parameters.length; i++) {
          var node = Polymer.dom(el).querySelector(params.parameters[i].select);
          assert.isDefined(node, params.parameters[i].select + ' is defined');
          for (var p in params.parameters[i]) {
            if (p === 'select') {
              continue;
            }
            assert.equal(getProperty(node, p), params.parameters[i][p], p + ' is set as ' + params.parameters[i][p]);
          }
        }
      });

*/
    });
  });

  var boundSuites = [
  /*
    { 
      suite: 'change bound text values', 
      fixture: 'bound-and-wrapped',
      target: 'simple',
      fixtureModel: {
        lang: lang1,
        text: [
          'Parameter {1} and {2} are rendered.',
          'A',
          'B'
        ]
      }, 
      assign: { 
        text: [
          'Param {2} and {1} are re-rendered.',
          'AAA',
          'BBB'
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'Param ' },
        { nodeName: 'CONTENT', select: '[param=\'2\']' },
        { nodeName: '#text', data: ' and ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' are re-rendered.' }
      ],
      parameters: [
        { select: 'b[param=\'1\']', textContent: 'AAA' },
        { select: 'i[param=\'2\']', textContent: 'BBB' }
      ]
    },
    { 
      suite: 'plural category other', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: []
      },
      assign: { 
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' },
          { name: 'Yoda', gender: 'other' }
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave them (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' other people gifts.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 2, formatted: '2', 'root.PolymerDom.children.0.textContent': '2' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'plural category one', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: []
      },
      assign: { 
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and one other person ' },
        { nodeName: 'CONTENT', select: '[param=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'plural category 0', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: { 
        recipients: []
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave no gifts.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: -1, formatted: '-1', rawNumber: 0, 'root.PolymerDom.children.0.textContent': '-1' },
        { select: 'span[param=\'2\']', textContent: '' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: '' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'plural category 1', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: { 
        recipients: [
          { name: 'Alice', gender: 'female' },
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') ' },
        { nodeName: 'CONTENT', select: '[param=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 0, formatted: '0', rawNumber: 1, 'root.PolymerDom.children.0.textContent': '0' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'update lang and re-render', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        lang: lang1,
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: { 
        lang: lang3 // 'ja' -> plural category 'other'
      },
      lang: lang3,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave them (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and ' },
        { nodeName: 'CONTENT', select: '[param=\'1\']' },
        { nodeName: '#text', data: ' other people gifts.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'empty text', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
      },
      assign: { 
        compoundText: []
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 2, formatted: '2', 'root.PolymerDom.children.0.textContent': '2' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: '' }
      ]
    },
    { 
      suite: 'illegal compound template', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
      },
      assign: { 
        compoundText: [
          { 'illegal': 'illegal compound template' }
        ]
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat1,
      childNodes: [],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 2, formatted: '2', 'root.PolymerDom.children.0.textContent': '2' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: '' }
      ]
    },
    { 
      suite: 'change paramFormat', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        compoundText: [
          {
            '0': 'You (%3%) gave no gifts.',
            '1': {
              'male': 'You (%3%) gave him (%4%) %5%.',
              'female': 'You (%3%) gave her (%4%) %5%.',
              'other': 'You (%3%) gave them (%4%) %5%.'
            },
            'one': {
              'male': 'You (%3%) gave him (%4%) and one other person %5%.',
              'female': 'You (%3%) gave her (%4%) and one other person %5%.',
              'other': 'You (%3%) gave them (%4%) and one other person %5%.'
            },
            'other': 'You (%3%) gave them (%4%) and %1% other people gifts.'
          },
          '{{recipients.length}}', // dummy
          '{{recipients.0.gender}}', // dummy
          '{{sender.name}}', // dummy
          '{{recipients.0.name}}', // dummy
          'a gift'
        ],
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: {
        paramFormat: paramFormat2
      },
      lang: lang1,
      paramAttribute: paramAttribute1,
      paramFormat: paramFormat2,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[param=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[param=\'4\']' },
        { nodeName: '#text', data: ') and one other person ' },
        { nodeName: 'CONTENT', select: '[param=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[param=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[param=\'2\']', textContent: 'female' },
        { select: 'span[param=\'3\']', textContent: 'Joe' },
        { select: 'span[param=\'4\']', textContent: 'Alice' },
        { select: 'span[param=\'5\']', textContent: 'a gift' }
      ]
    },
    { 
      suite: 'change paramAttribute', 
      fixture: 'bound-and-wrapped',
      target: 'compound',
      fixtureModel: {
        recipients: [
          { name: 'Alice', gender: 'female' },
          { name: 'Bob', gender: 'male' }
        ]
      },
      assign: {
        paramAttribute: paramAttribute2
      },
      lang: lang1,
      paramAttribute: paramAttribute2,
      paramFormat: paramFormat1,
      childNodes: [
        { nodeName: '#text', data: 'You (' },
        { nodeName: 'CONTENT', select: '[parameter=\'3\']' },
        { nodeName: '#text', data: ') gave her (' },
        { nodeName: 'CONTENT', select: '[parameter=\'4\']' },
        { nodeName: '#text', data: ') and one other person ' },
        { nodeName: 'CONTENT', select: '[parameter=\'5\']' },
        { nodeName: '#text', data: '.' }
      ],
      parameters: [
        { select: 'i18n-number[parameter=\'1\']', number: 1, formatted: '1', 'root.PolymerDom.children.0.textContent': '1' },
        { select: 'span[parameter=\'2\']', textContent: 'female' },
        { select: 'span[parameter=\'3\']', textContent: 'Joe' },
        { select: 'span[parameter=\'4\']', textContent: 'Alice' },
        { select: 'span[parameter=\'5\']', textContent: 'a gift' }
      ]
    }
  */
  ];

  suite('bound in a local DOM', function () {
    var wrapper;
    var el;

    var reattach = function (placeholder) {
      var simple = Polymer.dom(placeholder).querySelector('#simple');
      var compound = Polymer.dom(placeholder).querySelector('#compound');
      Polymer.dom(placeholder).removeChild(simple);
      Polymer.dom(placeholder).appendChild(simple);
      Polymer.dom(placeholder).removeChild(compound);
      Polymer.dom(placeholder).appendChild(compound);
    };

    boundSuites.forEach(function (params) {

      [ false, true ].forEach(function (isReattach) {

        suite(params.suite + (isReattach ? ' with reattaching' : ''), function () {

          setup(function () {
            wrapper = fixture(params.fixture, params.fixtureModel);
            if (isReattach) {
              reattach(wrapper.$.placeholder);
            }
            el = wrapper.$[params.target];
          });

          test('lang property is ' + params.lang, function () {
            updateModel(wrapper, params.assign);
            assert.equal(el.lang, params.lang, 'lang is ' + params.lang);
          });

          test('paramAttribute property is ' + params.paramAttribute, function () {
            updateModel(wrapper, params.assign);
            assert.equal(el.paramAttribute, params.paramAttribute, 'paramAttribute is ' + params.paramAttribute);
          });

          test('paramFormat property is ' + params.paramFormat, function () {
            updateModel(wrapper, params.assign);
            assert.equal(el.paramFormat, params.paramFormat, 'paramFormat is ' + params.paramFormat);
          });

          test('updated childNodes are ' + JSON.stringify(params.childNodes), function (done) {
            el.addEventListener('rendered', function (e) {
              if (e.target === el) {
                var childNodes = Polymer.dom(el.root).childNodes;
                var i;
                for (i = 0; i < params.childNodes.length; i++) {
                  for (var p in params.childNodes[i]) {
                    assert.equal(childNodes[i][p] || childNodes[i].getAttribute(p), params.childNodes[i][p], p + ' is set as ' + params.childNodes[i][p]);
                  }
                }
                done();
              }
            });
            updateModel(wrapper, params.assign);
          });

          test('updated parameters are ' + JSON.stringify(params.parameters), function (done) {
            el.addEventListener('rendered', function (e) {
              if (e.target === el) {
                var i;
                for (i = 0; i < params.parameters.length; i++) {
                  var node = Polymer.dom(el).querySelector(params.parameters[i].select);
                  assert.isDefined(node, params.parameters[i].select + ' is defined');
                  for (var p in params.parameters[i]) {
                    if (p === 'select') {
                      continue;
                    }
                    assert.equal(getProperty(node, p), params.parameters[i][p], p + ' is set as ' + params.parameters[i][p]);
                  }
                }
                done();
              }
            });
            updateModel(wrapper, params.assign);
          });

    /*
          suite('bound value changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.num;
            });

            test('change bound value to ' + rawNumber1, function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '123,456.789', 
                            'renders the formatted number');    
                done();
              });
              wrapper.number = rawNumber1;
            });

          });

          suite('bound value emptied' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.num2;
            });

            test('change bound value to empty', function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '', 
                            'renders the formatted number');    
                done();
              });
              wrapper.number2 = '';
            });

          });

          suite('non-bound empty textContent changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.empty;
            });

            test('change empty textContent value to ' + rawNumber1, function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '123,456.789', 
                            'renders the formatted number');    
                done();
              });
              Polymer.dom(el).textContent = rawNumber1;
            });

          });

          suite('currency options value changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.currency;
            });

            test('change currency options value to JPY', function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '123,457', 
                            'renders the formatted currency');
                done();
              });
              wrapper.options.currency = 'JPY';
              wrapper.notifyPath('options.currency', wrapper.options.currency, true);
            });

          });

          suite('currency options value changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.currency;
            });

            test('change currency options value to JPY and render()', function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '123,457', 
                            'renders the formatted currency');
                done();
              });
              wrapper.options.currency = 'JPY';
              el.render();
            });

          });

          suite('bound currency options value changed' 
                + (isReattach ? ' with reattaching' : ''), function () {
            setup(function () {
              el = wrapper.$.currency;
            });

            test('change bound currency options value to JPY', function (done) {
              el.addEventListener('rendered', function (e) {
                assert.equal(el.$.number.textContent, '123,457', 
                            'renders the formatted currency');
                done();
              });
              wrapper.$.currencySelector.select('JPY');
              //wrapper.notifyPath('options.currency', wrapper.options.currency, true);
            });

          });
    */
        });
      });
    });
  });

});
    </script>

  </body>
</html>
